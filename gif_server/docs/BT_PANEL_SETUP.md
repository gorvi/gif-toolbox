# 宝塔面板初始化配置指南

> 在 OpenCloudOS 9 上使用宝塔面板部署 `gif_server` 的配置建议

## 🎯 宝塔面板初始化配置选择

### 方案一：推荐方案（手动安装，更灵活）

**不选择任何一键安装套件**，直接关闭或跳过，然后手动安装所需软件。

**理由：**
- ✅ 我们的项目使用 Node.js，不需要 PHP/MySQL
- ✅ 使用 SQLite 数据库，不需要 MySQL
- ✅ 可以精确控制软件版本
- ✅ 避免安装不必要的软件，节省资源

**步骤：**
1. 点击右上角 **"X"** 关闭初始化窗口
2. 或者点击 **"不再显示推荐"**
3. 在宝塔面板中手动安装所需软件

---

### 方案二：选择 Docker 套件（如果计划使用 Docker）

如果计划使用 Docker 部署，可以选择 **Docker 套件**：

**选择：**
- ✅ **Docker 套件**
  - Nginx 1.28 ✅（需要，用于反向代理）
  - Docker服务 ✅（可选，如果使用 Docker 部署）

**不选择：**
- ❌ LNMP（包含 PHP，我们不需要）
- ❌ LAMP（包含 PHP，我们不需要）
- ❌ JAVA（包含 JDK，我们不需要）

**注意：** 即使选择 Docker 套件，我们仍然需要手动安装：
- Node.js 18+
- FFmpeg
- PM2

---

## 📋 左侧菜单设置建议

### 建议保留的功能：
- ✅ **网站** - 用于配置 Nginx 反向代理
- ✅ **文件** - 用于管理服务器文件
- ✅ **终端** - 用于执行命令
- ✅ **计划任务** - 用于定时清理文件
- ✅ **监控** - 用于监控服务器状态
- ✅ **安全** - 用于配置防火墙
- ✅ **日志** - 用于查看日志

### 可选功能：
- ⚠️ **数据库** - 我们使用 SQLite，不需要 MySQL，但可以保留用于其他用途
- ⚠️ **Docker** - 如果使用 Docker 部署，建议保留
- ⚠️ **域名** - 如果需要管理多个域名，建议保留
- ⚠️ **WAF** - 安全防护，建议保留

### 可以关闭的功能：
- ❌ **多用户** - 如果只有你一个人使用，可以关闭

---

## 🚀 推荐配置流程

### 步骤 1：关闭初始化窗口

点击右上角 **"X"** 或 **"不再显示推荐"**，不选择任何套件。

### 步骤 2：在宝塔面板中安装 Nginx

1. 进入 **"软件商店"**
2. 搜索 **"Nginx"**
3. 选择 **"Nginx 1.28"** 或最新版本
4. 点击 **"安装"**
5. 选择 **"极速安装"**（更快）

### 步骤 3：通过终端安装其他软件

打开宝塔面板的 **"终端"**，执行以下命令：

```bash
# 1. 安装 Node.js 18+
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs

# 2. 安装 EPEL 仓库
sudo dnf install -y epel-release

# 3. 安装 FFmpeg（需要 RPM Fusion 仓库）
sudo dnf install -y https://download1.rpmfusion.org/free/el/rpmfusion-free-release-9.noarch.rpm
sudo dnf install -y ffmpeg

# 4. 安装 PM2
sudo npm install -g pm2

# 验证安装
node --version    # v18.x.x
ffmpeg -version
pm2 --version
```

### 步骤 4：配置防火墙

在宝塔面板的 **"安全"** 页面：
- 开放端口 **80**（HTTP）
- 开放端口 **443**（HTTPS）
- 开放端口 **3000**（后端服务，仅本地访问，可选）

---

## 📝 详细配置说明

### 为什么不需要 LNMP/LAMP？

- **LNMP/LAMP 包含：**
  - Nginx/Apache ✅（我们需要）
  - MySQL ❌（我们使用 SQLite）
  - PHP ❌（我们使用 Node.js）
  - phpMyAdmin ❌（我们不需要）

- **我们的技术栈：**
  - Node.js（后端服务）
  - SQLite（数据库）
  - Nginx（反向代理）
  - FFmpeg（视频处理）

### 为什么推荐手动安装？

1. **精确控制版本**：可以安装 Node.js 18+，而不是系统默认版本
2. **节省资源**：不安装不需要的 PHP、MySQL 等
3. **更灵活**：可以根据需要选择安装方式
4. **更清晰**：知道安装了哪些软件，便于管理

---

## ✅ 最终建议

### 推荐操作：

1. **关闭初始化窗口**（不选择任何套件）
2. **保留左侧菜单**：网站、文件、终端、计划任务、监控、安全、日志
3. **在软件商店安装 Nginx**
4. **通过终端手动安装**：Node.js、FFmpeg、PM2

### 配置完成后：

按照 `DEPLOY_TENCENT_CLOUD.md` 文档继续部署后端服务。

---

## 🔧 宝塔面板后续配置

### 1. 配置 Nginx 反向代理

在宝塔面板的 **"网站"** 页面：
1. 点击 **"添加站点"**
2. 输入域名（如 `api.yourdomain.com`）
3. 选择 **"纯静态"** 或 **"反向代理"**
4. 配置反向代理到 `http://127.0.0.1:3000`

### 2. 配置 SSL 证书

在宝塔面板的 **"网站"** 页面：
1. 选择你的站点
2. 点击 **"SSL"**
3. 选择 **"Let's Encrypt"** 免费证书
4. 点击 **"申请"**

### 3. 配置计划任务（清理旧文件）

在宝塔面板的 **"计划任务"** 页面：
1. 添加 **"Shell 脚本"** 任务
2. 执行周期：每天
3. 脚本内容：
```bash
find /opt/gif_server/data -type f -mtime +2 -delete
```

---

## ⚠️ 注意事项

1. **不要安装 MySQL**：我们的项目使用 SQLite，不需要 MySQL
2. **不要安装 PHP**：我们的项目使用 Node.js，不需要 PHP
3. **Nginx 版本**：建议使用 1.28 或更高版本
4. **防火墙**：确保在宝塔面板中配置防火墙规则
5. **SSL 证书**：使用宝塔面板的 Let's Encrypt 功能申请证书

---

完成以上配置后，你的服务器就准备好了，可以开始部署 `gif_server` 后端服务！

