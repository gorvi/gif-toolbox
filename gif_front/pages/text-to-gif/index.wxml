<view class="page safe-area">
  <view class="top-toolbar">
    <view class="top-toolbar-left">
      <view class="top-toolbar-count-pill">
        <text class="top-toolbar-count">已输入 {{textLines.length}} 行</text>
      </view>
    </view>
  </view>

  <view class="panel glass-strong preview-panel">
    <view class="preview">
      <view class="text-preview" wx:if="{{textLines.length}}">
        <view class="preview-text" style="font-size: {{fontSize}}px; color: {{fontColor}}; font-family: {{fontFamily}}">
          {{currentPreviewText}}
        </view>
      </view>

      <view class="empty" wx:else>
        <view class="empty-title">还没有输入文字</view>
        <view class="empty-desc">每行文字将作为一帧</view>
        <view class="empty-actions">
          <view class="ui-btn ui-btn-green" bindtap="onStartEdit">
            <text class="ui-btn-icon">✎</text>
            <text class="ui-btn-label">开始制作</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="options glass" wx:if="{{textLines.length}}">
    <view class="opt-row">
      <text class="opt-label">文字内容</text>
      <view class="text-actions">
        <view class="ui-btn ui-btn-ghost ui-btn-mini" bindtap="onStartEdit">
          <text class="ui-btn-label">编辑文字</text>
        </view>
        <view class="ui-btn ui-btn-ghost ui-btn-mini" bindtap="onClearText">
          <text class="ui-btn-label">清空</text>
        </view>
      </view>
    </view>
    <view class="opt-hint">每行文字单独一帧</view>

    <view class="divider"></view>

    <picker mode="selector" range="{{fontFamilyList}}" value="{{fontFamilyIndex}}" bindchange="onFontFamilyChange">
      <view class="opt-row opt-row-tappable">
        <text class="opt-label">字体</text>
        <text class="opt-value">{{fontFamilyList[fontFamilyIndex]}}</text>
      </view>
    </picker>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">文字颜色</text>
      <view class="color-picker" bindtap="onFontColorPicker">
        <view class="color-preview" style="background-color: {{fontColor}};"></view>
      </view>
    </view>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">字号</text>
      <text class="opt-value">{{fontSize}} px</text>
    </view>
    <slider class="slider" min="12" max="72" step="2" value="{{fontSize}}" bindchange="onFontSizeChange" activeColor="#20c05c" />

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">背景颜色</text>
      <view class="color-picker" bindtap="onBgColorPicker">
        <view class="color-preview" style="background-color: {{bgColor}};"></view>
      </view>
    </view>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">帧时长</text>
      <text class="opt-value">{{frameDelayMs}} ms</text>
    </view>
    <slider class="slider" min="100" max="2000" step="50" value="{{frameDelayMs}}" bindchange="onDelayChange" activeColor="#20c05c" />

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">每秒帧数</text>
      <text class="opt-value">{{fps}} FPS</text>
    </view>
    <slider class="slider" min="1" max="30" step="1" value="{{fps}}" bindchange="onFpsChange" activeColor="#20c05c" />

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">动画效果</text>
      <picker mode="selector" range="{{animationList}}" value="{{animationIndex}}" bindchange="onAnimationChange">
        <view class="opt-row-tappable">
          <text class="opt-value">{{animationList[animationIndex]}}</text>
        </view>
      </picker>
    </view>
  </view>

  <view class="result glass" wx:if="{{outPath}}">
    <view class="result-title">预览</view>
    <image class="result-img" src="{{outPath}}" mode="widthFix" />
    <view class="result-actions">
      <button class="btn btn-primary" bindtap="onSave">保存到相册</button>
    </view>
  </view>

  <view class="bottom safe-area">
    <button class="btn btn-primary" bindtap="onPreview" disabled="{{processing}}">预览动画</button>
    <button class="btn btn-primary" bindtap="onGenerate" disabled="{{processing}}" wx:if="{{outPath}}">生成GIF</button>
    <view class="progress" wx:if="{{processing}}">{{progressText}}</view>
  </view>

  <view class="edit-modal" wx:if="{{editModalVisible}}" catchtouchmove="noop">
    <view class="edit-mask" catchtap="onCancelEditModal" catchtouchmove="noop"></view>
    <view class="edit-card glass" catchtap="noop" catchtouchmove="noop">
      <view class="edit-header">
        <view class="edit-btn" bindtap="onCancelEditModal">取消</view>
        <view class="edit-title">输入文字</view>
        <view class="edit-btn edit-btn-primary" bindtap="onConfirmEditModal">确定</view>
      </view>

      <view class="edit-body">
        <textarea class="edit-textarea" placeholder="每行文字单独一帧" value="{{editText}}" bindinput="onEditTextInput" auto-height="true" maxlength="1000"></textarea>
      </view>
    </view>
  </view>

  <view class="color-modal" wx:if="{{colorModalVisible}}" catchtouchmove="noop">
    <view class="color-mask" catchtap="onCancelColorModal" catchtouchmove="noop"></view>
    <view class="color-card glass" catchtap="noop" catchtouchmove="noop">
      <view class="color-header">
        <view class="color-btn" bindtap="onCancelColorModal">取消</view>
        <view class="color-title">选择颜色</view>
        <view class="color-btn color-btn-primary" bindtap="onConfirmColorModal">确定</view>
      </view>

      <view class="color-body">
        <view class="color-list">
          <view class="color-item" wx:for="{{colorOptions}}" wx:key="value" bindtap="onSelectColor" data-color="{{item.value}}">
            <view class="color-item-preview" style="background-color: {{item.value}};"></view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>