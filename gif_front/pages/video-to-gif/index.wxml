<view class="page safe-area">
  <!-- 左侧边缘触摸拦截区域（防止华为手机系统返回手势误触） -->
  <view 
    class="edge-touch-blocker"
    catchtouchstart="onEdgeTouchStart"
    catchtouchmove="onEdgeTouchMove"
    catchtouchend="onEdgeTouchEnd"
    catchtouchcancel="onEdgeTouchEnd"
  ></view>
  
  <!-- 顶部工具栏（右上角） -->
  <view class="top-toolbar">
    <view class="top-toolbar-left"></view>
    <view class="top-toolbar-right">
      <!-- 分辨率选择 -->
      <picker mode="selector" range="{{resolutionLabels}}" value="{{resolutionIndex}}" bindchange="onResolutionPick">
        <view class="top-toolbar-item">
          <text class="top-toolbar-text">{{resolutionLabels[resolutionIndex]}}</text>
          <text class="top-toolbar-icon">▼</text>
        </view>
      </picker>
      <!-- 帧率选择 -->
      <picker mode="selector" range="{{fpsLabels}}" value="{{fpsIndex}}" bindchange="onFpsPick">
        <view class="top-toolbar-item">
          <text class="top-toolbar-text">{{fpsLabels[fpsIndex]}}</text>
          <text class="top-toolbar-icon">▼</text>
        </view>
      </picker>
      <!-- 导出按钮 -->
      <view class="top-toolbar-export" bindtap="onExport">
        <text class="top-toolbar-export-text">预览</text>
      </view>
    </view>
  </view>
  
  <view class="panel glass-strong">
    <view class="preview">
      <block wx:if="{{videoPath}}">
        <!-- 单视频组件方案 -->
        <view
          class="video-container"
          id="mainVideoContainer"
          bindtouchstart="onTextGestureStart"
          bindtouchmove="onTextGestureMove"
          bindtouchend="onTextGestureEnd"
          bindtouchcancel="onTextGestureEnd"
        >
          <video
            id="videoPlayer"
            class="video"
            src="{{videoPath}}"
            controls="{{false}}"
            autoplay="{{false}}"
            show-center-play-btn="{{false}}"
            show-fullscreen-btn="{{false}}"
            show-play-btn="{{false}}"
            enable-progress-gesture="{{false}}"
            object-fit="contain"
            bindtimeupdate="onTimeUpdate"
            bindplay="onVideoPlay"
            bindpause="onVideoPause"
            bindended="onVideoEnded"
            binderror="onVideoError"
            bindloadedmetadata="onVideoLoaded"
          />
          <view
            class="video-letterbox video-letterbox-top"
            wx:if="{{showLetterboxOverlays && letterboxTopPx > 0}}"
            style="height: {{letterboxTopPx}}px;"
          ></view>
          <view
            class="video-letterbox video-letterbox-bottom"
            wx:if="{{showLetterboxOverlays && letterboxBottomPx > 0}}"
            style="height: {{letterboxBottomPx}}px;"
          ></view>
          <view
            class="video-letterbox video-letterbox-left"
            wx:if="{{showLetterboxOverlays && letterboxLeftPx > 0}}"
            style="width: {{letterboxLeftPx}}px; top: {{mainVideoDisplayYpx}}px; height: {{mainVideoDisplayHpx}}px;"
          ></view>
          <view
            class="video-letterbox video-letterbox-right"
            wx:if="{{showLetterboxOverlays && letterboxRightPx > 0}}"
            style="width: {{letterboxRightPx}}px; top: {{mainVideoDisplayYpx}}px; height: {{mainVideoDisplayHpx}}px;"
          ></view>
          <!-- 文字预览/编辑（直接在首页） -->
          <view 
            class="video-text-preview {{textActiveTab && textActiveTab !== 'none' ? 'video-text-editing' : ''}} {{textActiveTab === 'crop' ? 'video-text-disabled' : ''}}"
            wx:if="{{(textConfig.content && textActiveTab && textActiveTab !== 'none') || (textPreviewConfig && textPreviewConfig.content)}}"
            style="left: {{textActiveTab && textActiveTab !== 'none' && textConfig.content ? textConfig.x : (textPreviewConfig ? textPreviewConfig.x : 50)}}%; top: {{textActiveTab && textActiveTab !== 'none' && textConfig.content ? textConfig.y : (textPreviewConfig ? textPreviewConfig.y : 50)}}%;"
          >
            <view 
              class="text-drag-box {{textDragging ? 'text-dragging' : ''}}"
              wx:if="{{textConfig.content && textActiveTab && textActiveTab !== 'none'}}"
              bindtouchstart="onTextDragStart"
              bindtouchmove="onTextDragMove"
              bindtouchend="onTextDragEnd"
              bindtouchcancel="onTextDragEnd"
            >
              <view class="text-content-wrap" style="{{textConfig._bgStyle || ''}}">
                <text 
                  class="text-content {{textConfig.animation ? 'text-animation-' + textConfig.animation : ''}}"
                  style="color: {{textConfig.color}}; opacity: {{(100 - textConfig.textOpacity) / 100}}; font-size: {{textConfig.fontSizeNum}}px; -webkit-text-stroke: {{textConfig.strokeColor ? (textConfig.strokeWidth / 50) + 'px ' + textConfig.strokeColor : 'none'}}; text-shadow: {{textConfig._shadowStyle || 'none'}}; {{textConfig._animStyle || ''}}"
                >{{textConfig.content}}</text>
              </view>
              <view class="text-delete-btn" data-role="delete" catchtap="onTextDelete">×</view>
            </view>
            <view class="text-drag-box" wx:else>
              <view class="text-content-wrap" style="{{textPreviewConfig._bgStyle || ''}}">
                <text 
                  class="text-content {{textConfig.animation ? 'text-animation-' + textConfig.animation : ''}}"
                  style="color: {{textPreviewConfig.color}}; opacity: {{(100 - textPreviewConfig.textOpacity) / 100}}; font-size: {{textPreviewConfig.fontSize}}px; -webkit-text-stroke: {{textPreviewConfig.strokeColor ? (textPreviewConfig.strokeWidth / 50) + 'px ' + textPreviewConfig.strokeColor : 'none'}}; text-shadow: {{textPreviewConfig._shadowStyle || 'none'}}; {{textPreviewConfig._animStyle || ''}}"
                >{{textPreviewConfig.content}}</text>
              </view>
              <view class="text-delete-btn text-delete-btn-hidden">×</view>
            </view>
          </view>
          <!-- 裁剪预览框/编辑（直接在首页） -->
          <view 
            class="crop-preview-overlay {{textActiveTab === 'crop' ? 'crop-editing' : ''}}"
            wx:if="{{cropPreviewConfig}}"
          >
            <!-- 遮罩层：四个区域（上下左右）显示非裁剪区域 -->
            <!-- 上遮罩 -->
            <view class="crop-preview-mask crop-preview-mask-top" style="height: {{cropPreviewConfig.y}}%;"></view>
            <!-- 下遮罩 -->
            <view class="crop-preview-mask crop-preview-mask-bottom" style="top: {{cropPreviewConfig.y + cropPreviewConfig.height}}%; height: {{100 - cropPreviewConfig.y - cropPreviewConfig.height}}%;"></view>
            <!-- 左遮罩 -->
            <view class="crop-preview-mask crop-preview-mask-left" style="top: {{cropPreviewConfig.y}}%; left: 0; width: {{cropPreviewConfig.x}}%; height: {{cropPreviewConfig.height}}%;"></view>
            <!-- 右遮罩 -->
            <view class="crop-preview-mask crop-preview-mask-right" style="top: {{cropPreviewConfig.y}}%; left: {{cropPreviewConfig.x + cropPreviewConfig.width}}%; width: {{100 - cropPreviewConfig.x - cropPreviewConfig.width}}%; height: {{cropPreviewConfig.height}}%;"></view>
            <!-- 裁剪框 -->
            <view 
              class="crop-preview-box crop-box {{cropDragging ? 'crop-dragging' : ''}}"
              style="left: {{cropPreviewConfig.x}}%; top: {{cropPreviewConfig.y}}%; width: {{cropPreviewConfig.width}}%; height: {{cropPreviewConfig.height}}%;"
            >
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-drag-area"
                data-type="move"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-tl"
                data-type="resize-tl"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-tr"
                data-type="resize-tr"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-bl"
                data-type="resize-bl"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-br"
                data-type="resize-br"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-t"
                data-type="resize-t"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-b"
                data-type="resize-b"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-l"
                data-type="resize-l"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <view
                wx:if="{{textActiveTab === 'crop'}}"
                class="crop-handle crop-handle-r"
                data-type="resize-r"
                catchtouchstart="onCropDragStart"
                catchtouchmove="onCropDragMove"
                catchtouchend="onCropDragEnd"
                catchtouchcancel="onCropDragEnd"
              ></view>
              <!-- 裁剪比例标签 -->
              <view class="crop-preview-label" wx:if="{{cropPreviewConfig.aspectRatio !== 'free' && cropPreviewConfig.aspectRatio !== 'none'}}">
                {{cropPreviewConfig.aspectRatio}}
              </view>
            </view>
          </view>
        </view>
        <!-- 视频底部播放控制条（放在黑色背景区域内，类似剪映） -->
        <view class="video-playbar-overlay">
          <view class="control-bar">
            <view class="control-row control-row-top">
              <text class="time-text">{{clockText}}</text>
              <view class="control-right">
                <view class="ui-btn ui-btn-ghost" bindtap="onChooseVideo">
                  <text class="ui-btn-icon">↺</text>
                  <text class="ui-btn-label">换视频</text>
                </view>
                <view class="ui-btn ui-btn-ghost" bindtap="onFullscreenPreview">
                  <text class="ui-btn-icon">⤢</text>
                  <text class="ui-btn-label">全屏</text>
                </view>
              </view>
            </view>
            <view class="control-row control-row-bottom">
              <view class="ui-btn ui-btn-dark {{videoPlaying && !segmentPlaying ? 'ui-btn-active' : ''}}" bindtap="onToggleFullPlay">
                <text class="ui-btn-icon">{{videoPlaying && !segmentPlaying ? '⏸' : '▶'}}</text>
                <text class="ui-btn-label">全篇</text>
              </view>
              <view class="ui-btn ui-btn-green {{segmentPlaying ? 'ui-btn-active' : ''}}" bindtap="onToggleSegmentPlay">
                <text class="ui-btn-icon">{{segmentPlaying ? '⏸' : '▶'}}</text>
                <text class="ui-btn-label">片段</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <!-- 没有视频时显示占位符，点击选择视频 -->
      <view wx:else class="placeholder" bindtap="onChooseVideo">
        <view class="placeholder-title">选择视频</view>
        <view class="placeholder-desc">支持拍摄/相册，截取最长10秒</view>
      </view>
    </view>

    <!-- 主时间线：中间固定播放头 + 可横向拖动刻度条（不使用 scroll-view） -->
    <view 
      class="main-timeline" 
      wx:if="{{mainTimeline && mainTimeline.enabled}}"
      catchtouchstart="onMainTimelineTouchStart"
      catchtouchmove="onMainTimelineTouchMove"
      catchtouchend="onMainTimelineTouchEnd"
      catchtouchcancel="onMainTimelineTouchEnd"
    >
      <view class="main-timeline-playhead"></view>
      <view 
        class="main-timeline-inner {{videoPlaying && !(mainTimeline && mainTimeline.manualScrolling) ? 'main-timeline-inner-anim' : ''}}" 
        style="width: {{mainTimeline.contentWidthPx}}px; transform: translateX({{mainTimeline.offsetPx}}px);"
      >
        <!-- 主时间线截取高亮区（整体平移截取范围用） -->
        <view
          class="main-timeline-range"
          wx:if="{{mainTimeline.range && mainTimeline.range.widthPx > 0}}"
          style="left: {{mainTimeline.range.startPx}}px; width: {{mainTimeline.range.widthPx}}px;"
        ></view>
        <!-- 主时间线截取左右手柄（调节截取长度） -->
        <view
          class="main-timeline-handle main-timeline-handle-left"
          wx:if="{{mainTimeline.range && mainTimeline.range.widthPx > 0}}"
          style="left: {{mainTimeline.range.startPx}}px;"
          catchtouchstart="onMainHandleTouchStart"
          catchtouchmove="onMainHandleTouchMove"
          catchtouchend="onMainHandleTouchEnd"
          catchtouchcancel="onMainHandleTouchEnd"
          data-type="left"
        ></view>
        <view
          class="main-timeline-handle main-timeline-handle-right"
          wx:if="{{mainTimeline.range && mainTimeline.range.widthPx > 0}}"
          style="left: {{mainTimeline.range.startPx + mainTimeline.range.widthPx}}px;"
          catchtouchstart="onMainHandleTouchStart"
          catchtouchmove="onMainHandleTouchMove"
          catchtouchend="onMainHandleTouchEnd"
          catchtouchcancel="onMainHandleTouchEnd"
          data-type="right"
        ></view>
        <block wx:for="{{mainTimeline.ticks}}" wx:key="idx">
          <view
            class="main-timeline-tick main-timeline-tick-{{item.kind}}"
            style="left: {{item.leftPx}}px;"
          >
            <text class="main-timeline-tick-label" wx:if="{{item.label}}">{{item.label}}</text>
          </view>
        </block>
      </view>
      <!-- 截取起止时间标签（精确到 0.1 秒） -->
      <view class="main-timeline-end-label main-timeline-end-label-left">
        <text>{{startText}}</text>
      </view>
      <view class="main-timeline-end-label main-timeline-end-label-right">
        <text>{{endText}}</text>
      </view>
    </view>

  </view>

  <view class="options glass" wx:if="{{supportTip}}">
    <view class="tip">
      <text class="tip-title">能力说明</text>
      <text class="tip-content">{{supportTip}}</text>
    </view>
  </view>

  <!-- 底部导航栏（类似剪映） -->
  <view class="bottom-nav-bar safe-area {{textActiveTab && textActiveTab !== 'none' ? 'bottom-nav-bar-hidden' : ''}}">
    <view class="bottom-nav-item" bindtap="onClickCropTool">
      <view class="bottom-nav-icon">✂</view>
      <text class="bottom-nav-label">剪辑</text>
    </view>
    <view class="bottom-nav-item" bindtap="onClickTextTool">
      <view class="bottom-nav-icon">T</view>
      <text class="bottom-nav-label">文本</text>
    </view>
  </view>

  <!-- 抽屉式编辑组件（类似剪映） -->
  <view class="edit-drawer-mask {{textActiveTab && textActiveTab !== 'none' ? 'edit-drawer-mask-show' : ''}}" wx:if="{{textActiveTab && textActiveTab !== 'none'}}" catchtap="onDrawerMaskTap"></view>
  <view class="edit-drawer {{textActiveTab && textActiveTab !== 'none' ? 'edit-drawer-show' : ''}} {{keyboardHeightPx <= 0 ? 'edit-drawer-fill' : ''}}" wx:if="{{textActiveTab && textActiveTab !== 'none'}}" style="{{keyboardHeightPx > 0 ? ('height: ' + drawerHeightVh + 'vh; bottom: ' + keyboardHeightPx + 'px;') : ('top: ' + drawerTopPx + 'px; bottom: 0; height: auto;')}}">
    <view class="drawer-close-fab" bindtap="onCloseEditComponent">完成</view>
    
    <!-- 文字编辑组件 -->
    <view class="edit-component">
      <scroll-view class="text-tabs-scroll" scroll-x="{{true}}" scroll-with-animation="{{false}}">
        <view class="text-tabs">
          <view 
            class="text-tab {{textActiveTab === 'crop' ? 'text-tab-active' : ''}}"
            data-tab="crop"
            bindtap="onTextTabChange"
          >裁剪</view>
          <view 
            class="text-tab {{textActiveTab === 'keyboard' ? 'text-tab-active' : ''}}"
            data-tab="keyboard"
            bindtap="onTextTabChange"
          >文字</view>
          <view 
            class="text-tab {{textActiveTab === 'stroke' ? 'text-tab-active' : ''}}"
            data-tab="stroke"
            bindtap="onTextTabChange"
          >描边</view>
          <view 
            class="text-tab {{textActiveTab === 'shadow' ? 'text-tab-active' : ''}}"
            data-tab="shadow"
            bindtap="onTextTabChange"
          >阴影</view>
          <view 
            class="text-tab {{textActiveTab === 'bg' ? 'text-tab-active' : ''}}"
            data-tab="bg"
            bindtap="onTextTabChange"
          >背景</view>
          <view 
            class="text-tab {{textActiveTab === 'animation' ? 'text-tab-active' : ''}}"
            data-tab="animation"
            bindtap="onTextTabChange"
          >动画</view>
        </view>
      </scroll-view>

      <!-- 文字编辑内容区域 -->
      <view class="text-edit-content">
        <!-- 键盘tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'keyboard'}}">
          <view class="input-row">
            <textarea
              class="text-input"
              maxlength="30"
              placeholder="输入文字"
              value="{{textConfig.content}}"
              bindinput="onTextInput"
              bindfocus="onTextInputFocus"
              bindblur="onTextInputBlur"
              focus="{{textInputFocus}}"
              auto-height="{{true}}"
              adjust-position="{{false}}"
            ></textarea>
          </view>
          <block wx:if="{{keyboardHeightPx <= 0}}">
          <view class="slider-row">
            <text class="slider-label">字号</text>
            <slider 
              class="slider"
              min="12" 
              max="72" 
              value="{{textConfig.fontSizeNum}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onFontSizeSliderChange"
            />
          </view>
          <view class="color-picker">
            <view 
              class="color-item {{textConfig.color === item ? 'color-item-active' : ''}}"
              wx:for="{{colorOptions}}"
              wx:key="*this"
              data-color="{{item}}"
              bindtap="onTextColorChange"
              style="background: {{item}};"
            ></view>
          </view>
          <view class="slider-row">
            <text class="slider-label">透明度</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.textOpacity}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onTextOpacityChange"
            />
          </view>
          </block>
        </view>

        <!-- 描边tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'stroke'}}">
          <view class="color-picker">
            <view 
              class="color-item {{textConfig.strokeColor === item ? 'color-item-active' : ''}}"
              wx:for="{{colorOptions}}"
              wx:key="*this"
              data-color="{{item}}"
              bindtap="onStrokeColorChange"
              style="background: {{item}};"
            ></view>
          </view>
          <view class="slider-row">
            <text class="slider-label">粗细</text>
            <slider 
              class="slider"
              min="0" 
              max="50" 
              value="{{textConfig.strokeWidth}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onStrokeWidthChange"
            />
          </view>
          <view class="slider-row">
            <text class="slider-label">透明度</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.strokeOpacity}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onStrokeOpacityChange"
            />
          </view>
        </view>

        <!-- 阴影tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'shadow'}}">
          <view class="color-picker">
            <view 
              class="color-item {{textConfig.shadowColor === item ? 'color-item-active' : ''}}"
              wx:for="{{colorOptions}}"
              wx:key="*this"
              data-color="{{item}}"
              bindtap="onShadowColorChange"
              style="background: {{item}};"
            ></view>
          </view>
          <view class="slider-row">
            <text class="slider-label">模糊</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.shadowBlur}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onShadowBlurChange"
            />
          </view>
          <view class="slider-row">
            <text class="slider-label">距离</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.shadowDistance}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onShadowDistanceChange"
            />
          </view>
          <view class="slider-row">
            <text class="slider-label">角度</text>
            <slider 
              class="slider"
              min="0" 
              max="360" 
              value="{{textConfig.shadowAngle}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onShadowAngleChange"
            />
          </view>
          <view class="slider-row">
            <text class="slider-label">透明度</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.shadowOpacity}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onShadowOpacityChange"
            />
          </view>
        </view>

        <!-- 背景tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'bg'}}">
          <view class="color-picker">
            <view 
              class="color-item {{textConfig.bgColor === item ? 'color-item-active' : ''}}"
              wx:for="{{colorOptions}}"
              wx:key="*this"
              data-color="{{item}}"
              bindtap="onBgColorChange"
              style="background: {{item}};"
            ></view>
          </view>
          <view class="slider-row">
            <text class="slider-label">透明度</text>
            <slider 
              class="slider"
              min="0" 
              max="100" 
              value="{{textConfig.bgOpacity}}" 
              step="1"
              show-value="{{true}}"
              bindchange="onBgOpacityChange"
            />
          </view>
        </view>

        <!-- 动画tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'animation'}}">
          <view class="animation-options">
            <view 
              class="animation-item {{textConfig.animation === item.value ? 'animation-item-active' : ''}}"
              wx:for="{{animationOptions}}"
              wx:key="value"
              data-animation="{{item.value || 'none'}}"
              bindtap="onAnimationChange"
            >
              {{item.label}}
            </view>
          </view>
          <view class="slider-row">
            <text class="slider-label">速度</text>
            <slider 
              class="slider"
              min="0.5" 
              max="2" 
              value="{{textConfig.animationSpeed}}" 
              step="0.1"
              show-value="{{true}}"
              bindchange="onAnimationSpeedChange"
            />
          </view>
        </view>

        <!-- 裁剪tab -->
        <view class="text-tab-pane" wx:if="{{textActiveTab === 'crop'}}">
          <view class="crop-ratio-label">裁剪比例</view>
          <view class="crop-ratio-list">
            <view 
              class="crop-ratio-item {{cropConfig.aspectRatio === item.value ? 'crop-ratio-active' : ''}}"
              wx:for="{{cropAspectRatios}}"
              wx:key="value"
              data-ratio="{{item.value}}"
              bindtap="onCropAspectRatioChange"
            >
              {{item.label}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- GIF预览模态弹框 -->
  <view class="gif-preview-modal {{showGifPreview ? 'gif-preview-modal-show' : ''}}" wx:if="{{showGifPreview && outPath}}" catchtap="noop" catchtouchmove="">
    <view class="gif-preview-content" catchtap="noop">
      <view class="gif-preview-header">
        <text class="gif-preview-title">预览</text>
        <view class="gif-preview-close" bindtap="onCloseGifPreview">×</view>
      </view>
      <view class="gif-preview-body">
        <view class="gif-preview-image-wrap">
          <image class="gif-preview-img" src="{{outPath}}" mode="aspectFit" />
        </view>
        <view class="gif-meta-loading" wx:if="{{gifMetaLoading}}">读取参数…</view>
        <view class="gif-meta-error" wx:if="{{!gifMetaLoading && gifMetaError}}">{{gifMetaError}}</view>
        <view class="gif-meta-grid" wx:if="{{!gifMetaLoading && gifMeta}}">
          <view class="gif-meta-item">
            <text class="gif-meta-item-label">分辨率</text>
            <text class="gif-meta-item-value">{{gifMeta.resolution}}</text>
          </view>
          <view class="gif-meta-item">
            <text class="gif-meta-item-label">帧数</text>
            <text class="gif-meta-item-value">{{gifMeta.frames}}</text>
          </view>
          <view class="gif-meta-item">
            <text class="gif-meta-item-label">时长</text>
            <text class="gif-meta-item-value">{{gifMeta.duration}}</text>
          </view>
          <view class="gif-meta-item">
            <text class="gif-meta-item-label">大小</text>
            <text class="gif-meta-item-value">{{gifMeta.size}}</text>
          </view>
          <view class="gif-meta-item">
            <text class="gif-meta-item-label">FPS</text>
            <text class="gif-meta-item-value">{{gifMeta.fps}}</text>
          </view>
        </view>
      </view>
      <view class="gif-preview-actions">
        <button class="btn btn-primary" bindtap="onSave">保存到相册</button>
      </view>
    </view>
  </view>

  <!-- 全屏预览模态弹框 -->
  <view class="fullscreen-preview-modal {{showFullscreenPreview ? 'fullscreen-preview-modal-show' : ''}}" wx:if="{{showFullscreenPreview && videoPath}}" catchtouchmove="">
    <view class="fullscreen-preview-content" catchtap="noop">
      <view class="fullscreen-preview-header">
        <text class="fullscreen-preview-title">全屏预览</text>
        <view class="fullscreen-preview-close" bindtap="onCloseFullscreenPreview">×</view>
      </view>
      <view class="fullscreen-preview-body">
        <video
          id="fullscreenVideoPlayer"
          class="fullscreen-video"
          src="{{videoPath}}"
          controls="{{true}}"
          autoplay="{{false}}"
          show-center-play-btn="{{true}}"
          show-fullscreen-btn="{{false}}"
          show-play-btn="{{true}}"
          enable-progress-gesture="{{true}}"
          object-fit="contain"
          bindtimeupdate="onTimeUpdate"
          bindplay="onVideoPlay"
          bindpause="onVideoPause"
          bindended="onVideoEnded"
        />
      </view>
    </view>
  </view>

  <!-- 移除全屏编辑面板，改为首页直接编辑 -->
</view>
