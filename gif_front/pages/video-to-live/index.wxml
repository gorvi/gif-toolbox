<view class="page safe-area">
  <view class="top-toolbar">
    <view class="top-toolbar-left">
      <view class="top-toolbar-count-pill">
        <text class="top-toolbar-count">{{topInfoText}}</text>
      </view>
    </view>
    <view class="top-toolbar-right" wx:if="{{videoPath}}">
      <picker mode="selector" range="{{resolutionLabels}}" value="{{resolutionIndex}}" bindchange="onResolutionPick">
        <view class="top-toolbar-item">
          <text class="top-toolbar-text">{{resolutionLabels[resolutionIndex]}}</text>
          <text class="top-toolbar-icon">▼</text>
        </view>
      </picker>
    </view>
  </view>

  <view class="panel glass-strong preview-panel">
    <view class="preview" wx:if="{{videoPath}}">
      <video
        id="videoPlayer"
        class="video"
        src="{{videoPath}}"
        controls="{{true}}"
        autoplay="{{false}}"
        show-center-play-btn="{{true}}"
        show-fullscreen-btn="{{true}}"
        object-fit="contain"
        bindtimeupdate="onTimeUpdate"
        bindloadedmetadata="onVideoLoaded"
      />
      <view class="preview-actions">
        <view class="ui-btn ui-btn-ghost" bindtap="onChooseVideo">
          <text class="ui-btn-icon">↺</text>
          <text class="ui-btn-label">换视频</text>
        </view>
        <view class="ui-btn ui-btn-orange" bindtap="onPlaySegment" wx:if="{{durationS > 0}}">
          <text class="ui-btn-icon">{{segmentPlaying ? '⏸' : '▶'}}</text>
          <text class="ui-btn-label">片段</text>
        </view>
      </view>
    </view>

    <view class="empty" wx:else bindtap="onChooseVideo">
      <view class="empty-title">选择视频</view>
      <view class="empty-desc">截取 0.5–{{maxLiveDurationS}} 秒生成 Live 图（MP4）</view>
      <view class="empty-actions">
        <view class="ui-btn ui-btn-orange">
          <text class="ui-btn-icon">＋</text>
          <text class="ui-btn-label">选择视频</text>
        </view>
      </view>
    </view>
  </view>

  <view class="options glass" wx:if="{{videoPath}}">
    <view class="section-label">截取片段</view>

    <view class="opt-row">
      <text class="opt-label">开始</text>
      <text class="opt-value">{{startText}}</text>
    </view>
    <slider
      class="slider"
      value="{{startS}}"
      min="0"
      max="{{maxStartS}}"
      step="0.1"
      disabled="{{processing}}"
      bindchange="onStartSliderChange"
    />
    <view class="opt-hint">从视频中选择片段起点</view>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">时长</text>
      <text class="opt-value">{{lenText}}</text>
    </view>
    <slider
      class="slider"
      value="{{clipLenS}}"
      min="{{minLiveDurationS}}"
      max="{{maxLenS}}"
      step="0.1"
      disabled="{{processing}}"
      bindchange="onLenSliderChange"
    />
    <view class="opt-hint">越短越像 Live；建议 1–3 秒</view>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">保留声音</text>
      <view class="quality">
        <text class="quality-text">{{keepAudio ? '开' : '关'}}</text>
        <switch checked="{{keepAudio}}" bindchange="onKeepAudioChange" color="#ff7a00" />
      </view>
    </view>

    <view class="divider"></view>

    <view class="opt-row">
      <text class="opt-label">画质</text>
      <view class="quality">
        <text class="quality-text">{{qualityMode === 'HIGH' ? '高' : '标准'}}</text>
        <switch checked="{{qualityMode === 'HIGH'}}" bindchange="onQualityChange" color="#ff7a00" />
      </view>
    </view>
    <view class="opt-hint">高画质更清晰；标准更快</view>
  </view>

  <view class="panel glass-strong out-panel" wx:if="{{outPath}}">
    <view class="out-title">导出结果</view>
    <video class="video out-video" src="{{outPath}}" controls="{{true}}" object-fit="contain" />
  </view>

  <view class="bottom safe-area" wx:if="{{videoPath}}">
    <button class="btn btn-primary btn-orange" bindtap="onConvert" disabled="{{processing}}">{{primaryActionText}}</button>
    <button class="btn btn-ghost" bindtap="onSave" wx:if="{{outPath}}">保存到相册</button>
    <view class="progress" wx:if="{{processing}}">
      <progress percent="{{progressPercent}}" stroke-width="6" activeColor="#ff7a00" backgroundColor="rgba(0,0,0,0.08)" active="true" />
      <view class="progress-text">{{progressText}}</view>
    </view>
  </view>
</view>
